# üî¥ Vi·∫øt l·∫°i React Features b·∫±ng JavaScript

> ‚úÖ Hi·ªÉu s√¢u c√°ch React ho·∫°t ƒë·ªông b√™n trong b·∫±ng c√°ch t·ª± x√¢y d·ª±ng l·∫°i `createElement`, `render`, `useState` v√† Virtual DOM.

---

## üîß 1. T·ª± t·∫°o `createElement`

```js
function createElement(type, props = {}, ...children) {
  return {
    type,
    props: {
      ...props,
      children: children.flat(),
    },
  };
}

// V√≠ d·ª•:
const element = createElement("h1", { className: "title" }, "Hello React");
console.log(element);
```

üìå K·∫øt qu·∫£:

```js
{
  type: "h1",
  props: {
    className: "title",
    children: ["Hello React"]
  }
}
```

---

## üß± 2. H√†m `render` th·ªß c√¥ng

```js
function render(element, container) {
  if (typeof element === "string" || typeof element === "number") {
    container.appendChild(document.createTextNode(element));
    return;
  }

  const dom = document.createElement(element.type);

  // G√°n props (tr·ª´ children)
  for (const key in element.props) {
    if (key !== "children") {
      dom[key] = element.props[key];
    }
  }

  // Render ƒë·ªá quy con
  element.props.children.forEach((child) => render(child, dom));

  container.appendChild(dom);
}
```

‚úÖ **D√πng th·ª≠:**

```js
const App = createElement(
  "div",
  { id: "app" },
  createElement("h1", null, "Xin ch√†o"),
  createElement("p", null, "ƒê√¢y l√† demo React th·ªß c√¥ng!")
);

render(App, document.getElementById("root"));
```

---

## üß† 3. T·ª± t·∫°o `useState` ƒë∆°n gi·∫£n

```js
let state = [];
let index = 0;

function useState(initialValue) {
  const currentIndex = index;

  state[currentIndex] = state[currentIndex] ?? initialValue;

  function setState(newValue) {
    state[currentIndex] = newValue;
    rerender(); // G·ªçi l·∫°i render khi thay ƒë·ªïi
  }

  index++;
  return [state[currentIndex], setState];
}
```

üß™ **√ù t∆∞·ªüng d√πng:**

```js
function Counter() {
  const [count, setCount] = useState(0);

  return createElement(
    "button",
    {
      onclick: () => setCount(count + 1),
    },
    `Count: ${count}`
  );
}
```

---

## üîç 4. Virtual DOM & Diffing (c∆° b·∫£n)

```js
function diff(oldNode, newNode) {
  if (typeof oldNode !== typeof newNode) {
    return false;
  }
  if (typeof oldNode === "string" && oldNode !== newNode) {
    return false;
  }
  if (oldNode.type !== newNode.type) {
    return false;
  }

  // So s√°nh props ƒë∆°n gi·∫£n (ch∆∞a s√¢u)
  const oldProps = oldNode.props || {};
  const newProps = newNode.props || {};
  const oldKeys = Object.keys(oldProps);
  const newKeys = Object.keys(newProps);

  if (oldKeys.length !== newKeys.length) return false;

  for (let key of oldKeys) {
    if (key !== "children" && oldProps[key] !== newProps[key]) {
      return false;
    }
  }

  return true; // gi·ªëng nhau
}
```

üìò **Note:**

- React th·∫≠t d√πng Fiber v√† reconciliation t·ªëi ∆∞u h∆°n r·∫•t nhi·ªÅu.
- ƒê√¢y ch·ªâ l√† b·∫£n demo t·ªëi gi·∫£n ƒë·ªÉ hi·ªÉu c∆° ch·∫ø ch√≠nh.

---

## üéØ T√≥m t·∫Øt

- `createElement()` t·∫°o ra c√¢y ƒë·ªëi t∆∞·ª£ng nh∆∞ JSX.
- `render()` chuy·ªÉn ƒë·ªïi c√¢y ƒë·ªëi t∆∞·ª£ng th√†nh DOM th·∫≠t.
- `useState()` l∆∞u tr·∫°ng th√°i v√† c·∫≠p nh·∫≠t khi g·ªçi l·∫°i render.
- Virtual DOM gi√∫p so s√°nh v√† c·∫≠p nh·∫≠t DOM hi·ªáu qu·∫£ h∆°n.

---
